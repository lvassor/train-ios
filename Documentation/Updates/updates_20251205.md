# Strength Training App — Development Tasks

## Context

This is an iOS strength training app built in Swift. We're currently in MVP phase using local Core Data storage, with plans to migrate to a cloud database (likely Supabase) post-MVP for scalability and potential Android expansion.

## Implementation Instructions
Ensure you first read through the codebase and understand files and user flow in depth.
Implement these changes systematically after reading and understanding the requirements.
When you have completed all updates, provide me with a summary table of each task, what you have implemented and how you confirmed that everything works fine.
You are not permitted to delete any files, however renaming with the suffix _old and reporting this is permitted.
When building and simulating with xcode, you must use an iPhone 17 Pro simulator running iOS 26.1.

---

## Task 1: Exercise Database Architecture Redesign

### Context

We have an existing SQL schema for exercises. However we have a new Excel-based exercise database with an updated structure. 

Relevant files are in database-management.
The main exercise database is `train_exercise_database_prod.xlsx`. The first two sheets are relevant to creating our database in SQL. the othersheets are lookup tables to ensure data quality in master.

We also need `train_exercise_contraindications_prod.xlsx` which contains the main data sheet and schema sheet.

### Deliverable

1. Review the existing SQL schema in the codebase
2. Design a new SQL schema that accommodates the updated exercise database structure
3. Include proper foreign key relationships to lookup tables
4. Ensure the schema supports:
   - Filtering exercises by equipment the user has available - note that we have a hierarchy of equipment where `equipment_category` is the top level (expandable in the questionnaire equipment step) with expansion revealing nested equipment (lower hierarchical level) related to the `equipment_specific`.
   - Swapping exercises within the same canonical group (navigate to the swap feature in the workout logger to understand this)
   - Filtering by complexity level based on user experience
   - Filtering by muscle group for program generation
   - Filtering by isolation exercises
   - Filtering by inclusion flag - if 1 then include exercise in generated user programme elif 0 exercise is included in wider exercise library but not in programme itself.
   - Exercise library should show all exercises in databases by Display Name
   - Programme Generation should then store exercise display name.
   - Workout Logger should display exercise dusplay name.
5. Provide the complete SQL CREATE TABLE statements
6. Note any migration considerations from old to new schema and that front end function links through to the new db structure in the backend.
7. Note that we don't need to import the lookup tables as part of the database, those look ups were mainly just to enforce data quality controls on the main spreadsheet.

---
## Task 2: Equipment Availability Question — Expandable Detail

**Priority: Medium**

### Current behaviour

Users select broad equipment categories they have access to (e.g., "Barbells", "Pin-loaded machines", "Plate-loaded machines")

### New behaviour

When a user selects certain categories, they should be able to expand that selection (using a chevron on the right) to see specific equipment items within that category, with checkboxes to include/exclude specific pieces.

### Categories that need expansion

This expansion corresponds to the hierarchy of equipment types in the new equipment database implemented in task 1 where `equipment_category` is the top level (expandable in the questionnaire equipment step) with expansion revealing nested equipment (lower hierarchical level) related to the `equipment_specific`.

### Deliverable

1. Query the exercise database and extract the complete list of unique equipment that falls under `equipment_type` in `equipment_specific`. 
Note that dumbbells and kettlebells don't expand here because they have null `equipment_specific` since we don't break these down any further. 
   
2. Provide the complete list organised by category

3. Implement the expandable UI component:
   - Collapsed state: shows category with checkmark
   - Expanded state: shows all items within category with individual checkmarks
   - Parent checkbox behaviour: checking/unchecking parent affects all children
   - Mixed state: if some children unchecked, parent shows mixed indicator

4. Update the data model to store granular equipment selections


---
## Task 3: Injuries or Contraindications

### Context
In our onboarding questionnaire we have a question steps that asks the user if they have any injuries. However the answers available use the old world setup of muscle names but joints are more relevant to injuries.

### Deliverable
Change the answer options to the joint names that we now have in the new contraindications table from Task 1. The total unique set of names in column 2 of the table should available as individual answers for this question in the questionnaire. 

Note that this should feed through to the filtering mechanism that we have in our programme generation logic, such that exercises of certain canonical names in our table are filtered out from the programme should the user select an injury in this question.

---
## Task 4: Displayed contraindicated exercises

### Context
In task 1 and 2 I detailed that we store which exercise `canonical_name` links to injuries of certain joints. However, you'll note from task 1 that we don't actually filter out contraindicated exercises. For the MVP version we don't use this as a filter. However we will alert users when loggingt their generated programme.

### Deliverable
In the workout overview page (showing all exercises in the session), exercises that are contraindicated, i.e. their canonical name maps to a selected injury in the User info from the questionnaire which maps to the new contraindication table in our database, show a yellow triangle exclamation warning symbol on the card and when tapping this symbol a pop-up explains that this may aggravate the injury in their <join> that they recorded, and format the string with the joint the injury and exercise map to. The card element for that exercise should also be highlighted in light grey with transparency.
This warning symbol feature should also propagate through the exercise's individual card in the logger feature.


---
## Task 5: Muscle Group Selection in questionnaire
### Context
In our questionnaire we have a step where the user can select priority muscle groups, but the ruling is 0 to 3 priority groups. Currently, 0 selection does not permit the user to continue.

### Deliverable
Continue button should be illuminated with 0 selections and programme generation algorithm should accommodate a 0 answer without breaking.

---
## Task 6: Experience Level Question Redesign

**Priority: Medium**

### Current behaviour

We ask users how long they've been training and bucket them by time:
- Complete beginner
- 0-6 months
- 6 months - 2 years
- etc.

### Problem

Time-based bucketing doesn't account for confidence. Someone might have trained for years but still lack confidence, or be a natural who's confident after 3 months.

### New approach

Change to confidence-based self-assessment with 4 levels. Each option needs:
- A clear title
- Friendly, non-judgmental subheading text that helps users self-identify without feeling bad about their level

### Important: Complexity Mappings
How exercise complexity maps to experience levels, and the priority order for exercises during programme generation, are fully detailed in Section ## 6. Program Generation - Exercise Selection by Experience Level (iOS App) of Documentation/BUSINESS_RULES.md.


### Deliverable

Write the copy for 4 experience levels with:
- Title (short, e.g., "Complete Beginner")
- Subheading (1-2 sentences, warm and inviting tone)
- Map each level to the existing complexity score assignments

Example tone: "No worries if you're just starting out — everyone begins somewhere, and we'll make sure you're set up with exercises that build your confidence."

Surface this copy in the answers available for users in question 2 of the questionnaire - i.e. replace the old world time based answers and ensure that these changes propagate throughout the app where needed e.g. programme generation decision flow. 

---


## Task 7: Rest Timer UX Redesign


### Current behaviour

When a user marks a set as complete, a rest timer appears as a full-screen overlay. This blocks all other app interaction until the timer completes or is dismissed.

### Problem

Users can't do anything else while the timer runs (e.g., check upcoming exercises, review notes, scroll through their workout).

### New behaviour

Replace the overlay with an inline timer that appears within the exercise card:

**Placement:**
- Timer appears at the top of the exercise logger card
- Positioned below the set/rep prescription text
- Above the first input row where they log their actual numbers

**Appearance:**
- Single row, styled like an accent color button but with some transparency to not match accent exactly
- Contains: circular progress indicator + time remaining in numbers
- Should feel like a persistent but non-intrusive element

**Behaviour:**
- Timer starts automatically when user marks a set complete
- If user completes another set while timer is running: timer resets and restarts
- When timer reaches zero: timer collapses/hides automatically
- User can still interact with everything else in the app while timer runs
- Optional: tap timer to dismiss early

### Deliverable

1. Remove the existing overlay timer component
2. Create new inline timer component with the specifications above
3. Integrate into the exercise card layout
4. Handle timer reset logic when new set is completed
5. Animate the expand/collapse of the timer row

---

## Task 8: Bug Fix — Keyboard Dismissal

### Current behaviour

When users tap into the reps or load input fields:
- Number pad appears correctly (since these are integer fields)
- User enters their number
- There is no way to dismiss the number pad
- User is forced to navigate away from the exercise screen entirely to close it

When users tap into the account login or creation views:
- Keyboard appears correctly (since these are text fields: user and password)
- User enters their values
- There is no way to dismiss the keyboard
- User is forced to navigate away from the view entirely to close it or close the app

### Expected behaviour

User should be able to dismiss the number pador keyboard while staying on the same screen.

### Possible solutions

1. **Tap outside to dismiss**: Tapping anywhere outside the input field dismisses the keyboard
2. **Done button**: Add a "Done" button to the keyboard toolbar (standard iOS pattern)
3. **Scroll to dismiss**: If the logger is scrollable, enable keyboard dismissal on scroll

### Deliverable

Implement keyboard dismissal for inputs, using whichever approach best fits the existing UI patterns. Recommend option 2 (Done button toolbar) as it's the most explicit and iOS-native.

---
## Task 9: Charcoal Gradient Background — Fix Implementation

### Current behaviour

We attempted to implement a charcoal-style gradient background across the app, but it is not rendering anywhere. The background appears either as a solid colour or the default system background.

### Expected behaviour

A charcoal gradient background should be visible across full-screen view backgrounds, providing a consistent dark, modern aesthetic.

### Important: Background vs Material distinction

- **Full-screen view backgrounds** (Welcome, Login, Signup, Questionnaire, Dashboard, Workout Logger, etc.) → Use `charcoalGradientBackground()`
- **Scroll content / card views** (Profile/Account Settings, Library, Milestones, modal sheets) → Use `.ultraThinMaterial` with NO opacity modification

Do NOT apply the charcoal gradient to scroll content views or modals. Those should remain `.ultraThinMaterial` for the frosted glass effect.

### Deliverable

1. Create a new scheme in ColorPalettes.json called "Train Charcoal" with the diagonal gradient:
   - Light corner: #5E5E5E (medium gray, top-left)
   - Midpoint: #101010 (very dark gray, at 30% location)
   - Dark corner: #0B0B0B (near black, bottom-right)

2. Rename the view modifier from `warmDarkGradientBackground()` to `charcoalGradientBackground()` — no "warm" terminology

3. Apply `charcoalGradientBackground()` ONLY to full-screen view backgrounds:
   - WelcomeView
   - LoginView
   - SignupView
   - QuestionnaireView
   - DashboardView
   - WorkoutLoggerView / ExerciseLoggerView
   - ProgramReadyView
   - ProgramLoadingView
   - PaywallView

4. Keep `.ultraThinMaterial` for scroll/card views:
   - ProfileView (Account Settings)
   - CombinedLibraryView
   - MilestonesView
   - Modal sheets

5. Ensure the gradient works correctly with:
   - Extends to the very edges of the iphone screen.
   - Keyboard appearance (doesn't break when keyboard shows)

## Task 10: Progressive Overload Active Feedback: Rep Counter

### Current behaviour
We implement two forms of active feedback surrounding coaching progressive overload to the user. 

Firstly we use a rep counter which counts any extra reps that the user has made relative to the previous record of the same session in the programme (e.g. previous push session if they're prescribed push/pull/legs split).

### Deliverable
Ensure that this appears like the green text in this image
`/Users/lukevassor/Documents/trAIn-ios/Documentation/Updates/logger_view.jpeg`
and that the bahviour follows the rules set out in Section `## 2. Workout Logger - Rep Counter` of BUSINESS_RULES.md.

In our app it can be formatted with a palette colour and displayed in a nice circle that looks SwiftUI in appearance.

## Task 11: Progressive Overload Active Feedback: Load Progression Prompt

### Current behaviour
We implement two forms of active feedback surrounding coaching progressive overload to the user. 

Secondly, we implement prompting in the form of overlay modals that feedback on the reps/load recorded. These do not link to previous session data.

The curernt versions use messagign that needs changing.

### Deliverable
Ensure the bahviour follows the messaging and rules set out in Section `## 1. Workout Logger - Progression/Regression Prompts` of BUSINESS_RULES.md.

Keep the formatting over the overlay modal the same in our app.


## Task 11: Exercise Instructions

### Current behaviour
Currently we have a database of exercises that is used for programme generation and for browsing our exercise library. 
However, these do not contain any instructions on performing the exercise. 

You'll notice that following the following flow: navigating to the exercise library > click exercise > demo tab > Instructions

### Deliverable
This is currently a placeholder with no instructions. we now have these in the database that can be displayed. in the database these are enumerated 1 to 4 and each enumerated line item should be a new line.


## Task 12: Bug - logger view in exercise library
### Current Behaviour
There are two paths to a demo of an exercise - via the WorkoutLoggerView when actually recording a session and when navigating to the exercise library and clicking on a specific exercise then clicking the toggle to "Demo". 

However, the ability to logger ("Logger") should exclusively be available in the WorkoutLoggerView, not in the exercise library. Currently the user can see a logger interface in the exercise library when selecting an exercise and switching the toggle to `Logger`. This makes no sense within the exercise library because there is nothing to log here - there is no ongoing session.

### Deliverable
From within the exercise library, you can select an exercise but only the Demo tab should be available with no toggle. This demo is the same demo the user would see if they toggle from Logger to Demo within WorkoutLoggerView (i.e. it's a shared component/structure). Remove the logger from within the exercise library.

---
